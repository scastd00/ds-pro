<project name="RMIEvents" basedir="../" default="compile">
	<property name="client.src.dir" value="src/client"/>
	<property name="server.src.dir" value="src/server"/>
	<property name="policy.file" value="${client.src.dir}/all.policy"/>

	<property name="classes.dir" value="${basedir}/classes"/>
	<property name="client.dir" value="${classes.dir}/client"/>
	<property name="server.dir" value="${classes.dir}/server"/>
	<property name="stubs.dir" value="${classes.dir}/stubs"/>

	<property name="package.name" value="rmievents"/>
	<property name="server.class" value="${classes.dir}/${package.name}.Server"/>
	<property name="client.class" value="${classes.dir}/${package.name}.Client"/>

	<property name="stub-file" value="SDRemoteObject.class"/>
	<property name="web.dir" value="/var/www/html"/>

	<!-- Todo: IMPORTANT -> Value of remote object is samuel -->
	<property name="remote_object.name" value="samuel"/>
	<property name="webserver.ip" value="192.168.43.55"/>
	<property name="server_host.ip" value="192.168.43.55"/>

	<!-- Todo: Change when uploading to the server -->
	<property name="in.server" value="true"/>
	<property name="in.client" value="true"/>

	<property name="rmiregistry_path" value="/usr/bin/rmiregistry"/>

	<target name="clean_server">
		<delete dir="${server.dir}"/>
		<mkdir dir="${server.dir}"/>
	</target>

	<target name="clean_client">
		<delete dir="${client.dir}"/>
		<mkdir dir="${client.dir}"/>
	</target>

	<target name="compile_server" depends="clean_server" if="${in.server}">
		<javac srcdir="${server.src.dir}" destdir="${classes.dir}">
			<compilerarg value="-encoding"/>
			<compilerarg value="utf8"/>
		</javac>

		<copy file="${server.dir}/${package.name}/SDRemoteObject.class"
			  todir="${web.dir}/server/${package.name}"/>
	</target>

	<target name="compile_client" depends="clean_client" if="${in.client}">
		<copy file="${server.src.dir}/${package.name}/SDRemoteObject.java"
			  todir="${client.src.dir}"/>

		<javac srcdir="${client.src.dir}" destdir="${classes.dir}">
			<compilerarg value="-encoding"/>
			<compilerarg value="utf8"/>
		</javac>
	</target>

	<target name="rmiregistry">
		<exec executable="${rmiregistry_path}" spawn="true" dir="/">
			<arg value="-J-Djava.rmi.server.useCodebaseOnly=false"/>
		</exec>
	</target>

	<target name="run_server" depends="compile_server, rmiregistry">
		<java classpath="${classes.dir}" classname="server.${package.name}.Server"
			  fork="true" failonerror="true">
			<jvmarg value="-Djava.rmi.server.hostname=${server_host.ip}"/>
			<jvmarg value="-Djava.rmi.server.codebase=http://${webserver.ip}/"/>

			<arg value="${remote_object.name}"/>
		</java>
	</target>

	<target name="run_client" depends="compile_client">
		<copy file="${policy.file}" todir="${client.dir}"/>

		<java classpath="${classes.dir}" classname="client.${package.name}.Client"
			  fork="true" failonerror="true">

			<jvmarg value="-Djava.security.policy=${policy.file}"/>

			<arg value="${server_host.ip}"/>
			<arg value="${remote_object.name}"/>
		</java>
	</target>

	<target name="compile" depends="compile_client, compile_server">
		<echo>Compiled successfully</echo>
	</target>
</project>
